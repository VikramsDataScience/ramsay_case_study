# Ramsay Case Study

## Part 1: Data Exploration and Preparation
### On data issues:
<b>N.B. For the data issues identified here, please refer to the `src.preprocessing` module for the solutions.</b><br><br>
Referring to the ydata profiling report to help with EDA (please refer to `src.eda_profile_report`), and the identification of any quality/data issues, the following has come up:
- Missing numerical values in `CCU_Charges`, `ICU_Charge`, `TheatreCharge`, `ProsthesisCharge`, `OtherCharges`, `BundledCharges`, `UnplannedTheatreVisit`, `InfantWeight`, `Readmission28Days`, `HoursMechVentilation`, `PalliativeCareStatus`. The solution to this would be dynamic imputation using the <a href='https://pypi.org/project/MissForest/'> Missing Forest algorithm</a>. Missing Forest is more computationally expensive (especially for big datasets) but the result is a more dynamic imputation method for missing values. This is opposed to using simple means and medians, as any possible skewed values that may exist in the data set will only compound to become more skewed and further bias any inherent biases that may exist.
- Missing values that are mixed in `PharmacyCharge`. By mixed, there are many missing numerical values, but there are also some string  values such as 'error' that make up roughly 6.8% of the column. Since ~93% of the data in this column contain numerical values, I've chosen to convert the 'error' entries into NaNs.
<br>&nbsp;&nbsp;There is a further issue that expresses large integers in scientific notation (i.e. 1.09E+19). Whilst pandas sees these as float64 dtypes, it would've been ideal to convert these into large integers. However, this proved a problem that, at least, I wasn't able to repair in a timely manner. However, given that much of this case study is based on analysis and a proposal for a model, rather than building the model itself, I chose to leave this issue. However, on the job, this would be a problem that would need to be addressed.
<br>&nbsp;&nbsp;From here, use Missing Forest to perform dynamic numerical imputation. However, if this column contained primarily errors, and only a small amount of numerically filled values, this would be a different story, since we wouldn't have enough numerical samples to generate accurate dynamic imputations!
- Missing values in `UnplannedTheatreVisit`, `Readmission28Days`, and `PalliativeCareStatus` are binary categoricals (True/False). However, all three of these columns are missing ~96% of values! Since there are so many missing values in these categoricals, I've opted to create and impute a 3rd category called 'unknown'.
- Unsupported dtypes for `AdmissionTime` and `SeparationTime`. Python reads them as objects, and not the time as a 24 hour clock (HH:MM:SS). My proposed solution was to use pandas `to_datetime().dt.time` to only extract the values as time objects.

### On Feature creation:
<b>N.B. For the feature creation, please refer to the `src.preprocessing` module for the solution.</b><br>
- Since we have the `AdmissionDate` and the `SeparationDate` as part of the dataset, my thoughts were to create a `LengthOfStay` feature. Since patient LOS impacts private healthcare profitability and operations, there is a point of optimality to patient LOS, whilst still balancing both ethical and legal commitments to patient care. My thought was to create this feature and use it as a predictor for optimal LOS (please refer to the final section on Model Development for how I think this might be achieved).

## Part 2: Data Analysis and Visualisation
### DRG analysis
<b>N.B. For this section please refer to the `src.drg_analysis` module and plots generated by this module title `max_Charges_by_DRG.html` and `sum_Charges_by_DRG.html`.</b>
<br>&nbsp;&nbsp;For DRGs, I've looked and plotted with Plotly the DRGs that generate the Maximum revenue, the Mean, and the total Sum over the full course of the dataset:
- <b>Maximum Charges by DRG</b>: DRG10B with $14.18k in revenue, but only accounts for 20 surgeries in the total dataset. This is followed closely by DRG003 with $14.14k. A key difference is that DRG003 has generated 5,044 surgeries in the time period covered by the dataset!
- <b>Total (Summed) Charges by DRG</b>: DRG003, DRG002, and DRG001 are the largest 'earners' by way of total revenue, with total earnings of $37.73M, $37.66M, and $36.64M, respectively. Out of all the total DRGs these three combined account for about half of the dataset with a total of 14,987 surgeries across Urgent/Emergency, and Elective categories of admission.
<br>&nbsp;&nbsp;Certain DRGs, especially complex or high-risk treatments (e.g., involving ICU or prostheses), are likely to accrue the largest charges. Drivers of higher charges could be factors like CareType (inpatient/outpatient), emergency vs elective admissions, and usage of resources such as ICU and theatre facilities.

### Results of SQL query for total and average monthly admissions
<b>N.B. For this section please refer to the `src.sql_queries` module. And, for the results of those queries, please refer to `data/Total_Average_Admissions.csv` and `data/Percentile_Charges_by_Diagnosis_Sex.csv`.</b>
<br>&nbsp;&nbsp;Examining the results contained in the `Percentile_Charges_by_Diagnosis_Sex.csv` file, these are some observations:
- Some clinical codes don't change but are fixed charges. Initially I had thought my SQL query was very flawed! But closer examination then appeared that it may be that certain clinical codes don't vary in charges, but that was also not the case - one example is how A00.4 in row 4 does vary across percentile, but the same code doesn't vary in row 5, since it's a different patient (episode_id) that have different diagnoses (diagnosis1 -> 4 columns). These additional diagnoses (and therefore additional charges) could be driven by the presence of comorbidities or additional postsurgical complications? So in noting this it appears to be part of the data, and not the SQL query.
- In observing the above, I ran a filter to determine how often the distribution between the `25th Percentile` was the same as the `Maximum`. Out of the total 22,857 rows 16,957 (74%) of the cases the charges don't change. So, it looks like only in 26% of the surgical cases have the costs changed between the 25th Percentile and the Maximum.

## Part 3: Strategic Insights and Recommendations
